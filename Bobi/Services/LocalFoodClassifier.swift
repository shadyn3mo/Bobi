import Foundation

@available(iOS 17.0, *)
actor LocalFoodClassifier {
    static let shared = LocalFoodClassifier()
    
    private init() {}
    
    nonisolated private let chineseFoodNormalizationMap: [String: String] = [
        // è‹¹æœå˜ä½“
        "é’è‹¹æœ": "è‹¹æœ", "çº¢è‹¹æœ": "è‹¹æœ", "çº¢å¯Œå£«": "è‹¹æœ", "å¯Œå£«è‹¹æœ": "è‹¹æœ",
        "è›‡æœ": "è‹¹æœ", "å˜å•¦æœ": "è‹¹æœ", "å˜å•¦è‹¹æœ": "è‹¹æœ", "é»„å…ƒå¸…": "è‹¹æœ",
        "å›½å…‰è‹¹æœ": "è‹¹æœ", "é‡‘å¸…": "è‹¹æœ", "çƒŸå°è‹¹æœ": "è‹¹æœ",
        
        // é¦™è•‰å˜ä½“
        "é¦™è•‰": "é¦™è•‰", "èŠ­è•‰": "é¦™è•‰", "çš‡å¸è•‰": "é¦™è•‰", "å¸ç‹è•‰": "é¦™è•‰",
        "å°ç±³è•‰": "é¦™è•‰", "ç²‰è•‰": "é¦™è•‰",
        
        // æ©™å­/æŸ‘æ©˜ç±»
        "è„æ©™": "æ©™å­", "è¡€æ©™": "æ©™å­", "ç”œæ©™": "æ©™å­", "å†°ç³–æ©™": "æ©™å­",
        "æ©˜å­": "æ©˜å­", "æ¡”å­": "æ©˜å­", "ç ‚ç³–æ©˜": "æ©˜å­", "æ²ƒæŸ‘": "æ©˜å­",
        "èœœæ©˜": "æ©˜å­", "è´¡æŸ‘": "æ©˜å­", "æ¤ªæŸ‘": "æ©˜å­",
        "æŸšå­": "æŸšå­", "çº¢å¿ƒæŸš": "æŸšå­", "ç™½å¿ƒæŸš": "æŸšå­", "èœœæŸš": "æŸšå­",
        
        // è‘¡è„å˜ä½“
        "çº¢è‘¡è„": "è‘¡è„", "ç»¿è‘¡è„": "è‘¡è„", "é»‘è‘¡è„": "è‘¡è„", "ç´«è‘¡è„": "è‘¡è„",
        "å·¨å³°è‘¡è„": "è‘¡è„", "å¤é»‘è‘¡è„": "è‘¡è„", "ç«ç‘°é¦™è‘¡è„": "è‘¡è„", "æå­": "è‘¡è„",
        "çº¢æ": "è‘¡è„", "é»‘æ": "è‘¡è„", "é’æ": "è‘¡è„",
        
        // æ¢¨å˜ä½“
        "é¸­æ¢¨": "æ¢¨", "é›ªæ¢¨": "æ¢¨", "é¦™æ¢¨": "æ¢¨", "è´¡æ¢¨": "æ¢¨", "ç €å±±æ¢¨": "æ¢¨",
        "ç§‹æœˆæ¢¨": "æ¢¨", "çš‡å† æ¢¨": "æ¢¨", "åº“å°”å‹’é¦™æ¢¨": "æ¢¨",
        
        // æ¡ƒå­å˜ä½“
        "æ°´èœœæ¡ƒ": "æ¡ƒå­", "é»„æ¡ƒ": "æ¡ƒå­", "æ¯›æ¡ƒ": "æ¡ƒå­", "æ²¹æ¡ƒ": "æ¡ƒå­",
        "èŸ æ¡ƒ": "æ¡ƒå­", "ç™½æ¡ƒ": "æ¡ƒå­",
        
        // è¥¿ç“œ/ç“œç±»
        "æ— ç±½è¥¿ç“œ": "è¥¿ç“œ", "é»‘ç¾äººè¥¿ç“œ": "è¥¿ç“œ", "éº’éºŸç“œ": "è¥¿ç“œ",
        "å“ˆå¯†ç“œ": "å“ˆå¯†ç“œ", "é¦™ç“œ": "é¦™ç“œ", "ç”œç“œ": "é¦™ç“œ", "ç™½å…°ç“œ": "é¦™ç“œ",
        
        // ç™½èœå˜ä½“
        "å¤§ç™½èœ": "ç™½èœ", "å°ç™½èœ": "ç™½èœ", "å¨ƒå¨ƒèœ": "ç™½èœ", "å¥¶ç™½èœ": "ç™½èœ",
        "é’èœ": "é’èœ", "èœå¿ƒ": "èœå¿ƒ", "æ²¹èœ": "æ²¹èœ", "ç”Ÿèœ": "ç”Ÿèœ", "è´è‹£": "ç”Ÿèœ", "ç½—é©¬ç”Ÿèœ": "ç”Ÿèœ",
        "æ²¹éº¦èœ": "æ²¹éº¦èœ", "è´ç¬‹å¶": "æ²¹éº¦èœ", "è‹¦è‹£": "è‹¦è‹£",
        
        // ç•ªèŒ„åŒä¹‰è¯
        "ç•ªèŒ„": "è¥¿çº¢æŸ¿", "è¥¿çº¢æŸ¿": "è¥¿çº¢æŸ¿", "åœ£å¥³æœ": "å°ç•ªèŒ„", "æ¨±æ¡ƒç•ªèŒ„": "å°ç•ªèŒ„",
        "åƒç¦§æœ": "å°ç•ªèŒ„", "å°è¥¿çº¢æŸ¿": "å°ç•ªèŒ„",
        
        // åœŸè±†åŒä¹‰è¯
        "åœŸè±†": "åœŸè±†", "é©¬é“ƒè–¯": "åœŸè±†", "æ´‹èŠ‹": "åœŸè±†", "å±±è¯è›‹": "åœŸè±†",
        "è·å…°è–¯": "åœŸè±†", "åœ°è›‹": "åœŸè±†",
        
        // é»„ç“œå˜ä½“
        "å°é»„ç“œ": "é»„ç“œ", "é’ç“œ": "é»„ç“œ", "åˆºé»„ç“œ": "é»„ç“œ", "æ—±é»„ç“œ": "é»„ç“œ",
        "æ°´æœé»„ç“œ": "é»„ç“œ",
        
        // è¾£æ¤’å˜ä½“
        "é’æ¤’": "é’æ¤’", "ç”œæ¤’": "é’æ¤’", "å½©æ¤’": "å½©æ¤’", "çº¢æ¤’": "çº¢æ¤’",
        "é»„æ¤’": "é»„æ¤’", "å°–æ¤’": "å°–æ¤’", "èºä¸æ¤’": "å°–æ¤’", "æœå¤©æ¤’": "æœå¤©æ¤’",
        "å°ç±³æ¤’": "å°ç±³æ¤’", "äºŒè†æ¡": "è¾£æ¤’", "çº¿æ¤’": "è¾£æ¤’",
        
        // æ´‹è‘±å˜ä½“
        "ç´«æ´‹è‘±": "æ´‹è‘±", "ç™½æ´‹è‘±": "æ´‹è‘±", "é»„æ´‹è‘±": "æ´‹è‘±",
        
        // ç‰›å¥¶å˜ä½“
        "çº¯ç‰›å¥¶": "ç‰›å¥¶", "å…¨è„‚ç‰›å¥¶": "ç‰›å¥¶", "è„±è„‚ç‰›å¥¶": "ç‰›å¥¶", "ä½è„‚ç‰›å¥¶": "ç‰›å¥¶",
        "é²œç‰›å¥¶": "ç‰›å¥¶", "å·´æ°å¥¶": "ç‰›å¥¶", "å¸¸æ¸©å¥¶": "ç‰›å¥¶", "æœ‰æœºç‰›å¥¶": "ç‰›å¥¶",
        
        // é…¸å¥¶å˜ä½“
        "åŸå‘³é…¸å¥¶": "é…¸å¥¶", "æœå‘³é…¸å¥¶": "é…¸å¥¶", "å¸Œè…Šé…¸å¥¶": "é…¸å¥¶", "è€é…¸å¥¶": "é…¸å¥¶",
        "ç›Šç”ŸèŒé…¸å¥¶": "é…¸å¥¶", "é£å‘³é…¸å¥¶": "é…¸å¥¶",
        
        // é¸¡è›‹å˜ä½“
        "åœŸé¸¡è›‹": "é¸¡è›‹", "æ´‹é¸¡è›‹": "é¸¡è›‹", "æŸ´é¸¡è›‹": "é¸¡è›‹", "è‰é¸¡è›‹": "é¸¡è›‹",
        "é¸­è›‹": "é¸­è›‹", "é¹…è›‹": "é¹…è›‹", "é¹Œé¹‘è›‹": "é¹Œé¹‘è›‹",
        
        // è‚‰ç±»å˜ä½“
        "çŒªé‡Œè„Š": "çŒªè‚‰", "çŒªæ’éª¨": "çŒªè‚‰", "äº”èŠ±è‚‰": "çŒªè‚‰", "çŒªè¹„": "çŒªè‚‰",
        "å‰è…¿è‚‰": "çŒªè‚‰", "åè…¿è‚‰": "çŒªè‚‰", "æ¢…èŠ±è‚‰": "çŒªè‚‰", "çŒªé¢ˆè‚‰": "çŒªè‚‰",
        "ç‰›é‡Œè„Š": "ç‰›è‚‰", "ç‰›è…©": "ç‰›è‚‰", "ç‰›æ’": "ç‰›è‚‰", "ç‰›è…±": "ç‰›è‚‰",
        "é¸¡èƒ¸è‚‰": "é¸¡è‚‰", "é¸¡è…¿": "é¸¡è‚‰", "é¸¡ç¿…": "é¸¡è‚‰", "é¸¡çˆª": "é¸¡è‚‰",
        "ç¾Šè…¿": "ç¾Šè‚‰", "ç¾Šæ’": "ç¾Šè‚‰", "ç¾Šè‚‰ä¸²": "ç¾Šè‚‰",
        
        // é±¼ç±»å˜ä½“
        "ä¸‰æ–‡é±¼": "ä¸‰æ–‡é±¼", "é²‘é±¼": "ä¸‰æ–‡é±¼", "é‡‘æªé±¼": "é‡‘æªé±¼", "åæ‹¿é±¼": "é‡‘æªé±¼",
        "é²ˆé±¼": "é²ˆé±¼", "é²¤é±¼": "é²¤é±¼", "è‰é±¼": "è‰é±¼", "å¸¦é±¼": "å¸¦é±¼",
        "é»„èŠ±é±¼": "é»„èŠ±é±¼", "é²«é±¼": "é²«é±¼", "ç½—éé±¼": "ç½—éé±¼", "é³•é±¼": "é³•é±¼",
        
        // ç±³é¢ç±»
        "ä¸œåŒ—å¤§ç±³": "å¤§ç±³", "æ³°å›½é¦™ç±³": "å¤§ç±³", "é•¿ç²’ç±³": "å¤§ç±³", "ç³¯ç±³": "ç³¯ç±³",
        "é»‘ç±³": "é»‘ç±³", "ç³™ç±³": "ç³™ç±³", "å°ç±³": "å°ç±³",
        "é«˜ç­‹é¢ç²‰": "é¢ç²‰", "ä¸­ç­‹é¢ç²‰": "é¢ç²‰", "ä½ç­‹é¢ç²‰": "é¢ç²‰",
        "å…¨éº¦é¢ç²‰": "å…¨éº¦ç²‰", "ç‰ç±³é¢": "ç‰ç±³ç²‰",
        
        // æ›´å¤šè”¬èœå˜ä½“
        "èŠ¦ç¬‹": "èŠ¦ç¬‹", "ç”œèœ": "ç”œèœ", "æŠ±å­ç”˜è“": "æŠ±å­ç”˜è“", "ç¾½è¡£ç”˜è“": "ç¾½è¡£ç”˜è“",
        "éŸ­è‘±": "éŸ­è‘±", "æ¬§èŠ¹": "æ¬§èŠ¹", "èåœ": "èåœ", "è èœ": "è èœ",
        "ç‘å£«ç”œèœ": "ç‘å£«ç”œèœ", "èŠœè": "èŠœè", "æœé²œè“Ÿ": "æœé²œè“Ÿ", "èŠéº»èœ": "èŠéº»èœ",
        "è±†èŠ½": "è±†èŠ½", "èŒ´é¦™": "èŒ´é¦™", "ç§‹è‘µ": "ç§‹è‘µ", "è±Œè±†": "è±Œè±†", "å¤§é»„": "å¤§é»„",
        
        // ä¸­å¼è”¬èœ
        "éŸ­èœ": "éŸ­èœ", "éŸ­é»„": "éŸ­èœ", "éŸ­èœèŠ±": "éŸ­èœ",
        "ç©ºå¿ƒèœ": "ç©ºå¿ƒèœ", "é€šèœ": "ç©ºå¿ƒèœ", "æ°´è èœ": "ç©ºå¿ƒèœ",
        "èŠ¥è“": "èŠ¥è“", "èŒ¼è’¿": "èŒ¼è’¿", "è’¿å­æ†": "èŒ¼è’¿",
        "è‹‹èœ": "è‹‹èœ", "çº¢è‹‹èœ": "è‹‹èœ", "ç™½è‹‹èœ": "è‹‹èœ",
        "è èœ": "è èœ", "è±†è‹—": "è±†è‹—", "è±Œè±†è‹—": "è±†è‹—",
        "è±†è§’": "è±†è§’", "å››å­£è±†": "è±†è§’", "ç»¿è±†": "ç»¿è±†", "èŠ¸è±†": "è±†è§’",
        "æ‰è±†": "æ‰è±†", "èš•è±†": "èš•è±†", "æ¯›è±†": "æ¯›è±†",
        "è´ç¬‹": "è´ç¬‹", "è´è‹£èŒ": "è´ç¬‹",
        "èœèŠ±": "èŠ±èœ", "èŠ±æ¤°èœ": "èŠ±èœ", "ç™½èŠ±èœ": "èŠ±èœ",
        "ç´«ç”˜è“": "ç´«ç”˜è“", "çº¢å·å¿ƒèœ": "ç´«ç”˜è“",
        
        // ç“œç±»æ‰©å……
        "å†¬ç“œ": "å†¬ç“œ", "ä¸ç“œ": "ä¸ç“œ", "è‹¦ç“œ": "è‹¦ç“œ", "å‡‰ç“œ": "è‹¦ç“œ",
        "å—ç“œ": "å—ç“œ", "ç•ªç“œ": "å—ç“œ", "å€­ç“œ": "å—ç“œ",
        "ä½›æ‰‹ç“œ": "ä½›æ‰‹ç“œ", "åˆæŒç“œ": "ä½›æ‰‹ç“œ",
        "èŠ‚ç“œ": "èŠ‚ç“œ", "æ¯›ç“œ": "èŠ‚ç“œ",
        "ç“ å­": "ç“ å­", "è‘«èŠ¦": "ç“ å­",
        
        // æ›´å¤šæ°´æœ
        "è“è“": "è“è“", "è”“è¶Šè“": "è”“è¶Šè“", "æ— èŠ±æœ": "æ— èŠ±æœ",
        "çŒ•çŒ´æ¡ƒ": "çŒ•çŒ´æ¡ƒ", "è”æ": "è”æ", "æœ¨ç“œ": "æœ¨ç“œ",
        "æŸ¿å­": "æŸ¿å­", "çŸ³æ¦´": "çŸ³æ¦´", "è¦†ç›†å­": "è¦†ç›†å­", "æ¨æ¡ƒ": "æ¨æ¡ƒ",
        
        // æ›´å¤šçƒ­å¸¦å’Œåœ°æ–¹æ°´æœ
        "é¾™çœ¼": "é¾™çœ¼", "æ¡‚åœ†": "é¾™çœ¼", "çº¢æ¯›ä¸¹": "çº¢æ¯›ä¸¹", "å±±ç«¹": "å±±ç«¹",
        "æ¦´è²": "æ¦´è²", "ç«é¾™æœ": "ç«é¾™æœ", "ç™¾é¦™æœ": "ç™¾é¦™æœ", "è¥¿ç•ªè²": "ç™¾é¦™æœ",
        "è²é›¾": "è²é›¾", "è’²æ¡ƒ": "è²é›¾", "ç•ªçŸ³æ¦´": "ç•ªçŸ³æ¦´", "èŠ­ä¹": "ç•ªçŸ³æ¦´",
        "é‡Šè¿¦": "é‡Šè¿¦", "ç•ªè”æ": "é‡Šè¿¦", "äººå‚æœ": "äººå‚æœ",
        "æ‡æ·": "æ‡æ·", "æ¨æ¢…": "æ¨æ¢…", "å±±æ¢…": "æ¨æ¢…",
        "æ¡‘è‘š": "æ¡‘è‘š", "æ¡‘æœ": "æ¡‘è‘š", "é…¸æ£": "é…¸æ£", "æ²™æ£˜": "æ²™æ£˜",
        
        // é¦™æ–™å’Œè°ƒå‘³èœ
        "ç½—å‹’": "ç½—å‹’", "é¦™èœ": "é¦™èœ", "èŠ«è½": "é¦™èœ",
        "è³è": "è³è", "è–„è·": "è–„è·", "ç‰›è‡³": "ç‰›è‡³",
        "è¿·è¿­é¦™": "è¿·è¿­é¦™", "é¼ å°¾è‰": "é¼ å°¾è‰", "ç™¾é‡Œé¦™": "ç™¾é‡Œé¦™",
        
        // æ›´å¤šä¸­å¼é¦™æ–™å’Œè°ƒå‘³èœ
        "ç´«è‹": "ç´«è‹", "é±¼è…¥è‰": "é±¼è…¥è‰", "æŠ˜è€³æ ¹": "é±¼è…¥è‰",
        "é©¬é½¿è‹‹": "é©¬é½¿è‹‹", "è’²å…¬è‹±": "è’²å…¬è‹±", "è½¦å‰è‰": "è½¦å‰è‰",
        "è‰¾è‰": "è‰¾è‰", "è‰¾å¶": "è‰¾è‰", "è–„è·å¶": "è–„è·", "èƒ¡æ¤’å¶": "èƒ¡æ¤’å¶"
    ]
    
    nonisolated private let englishFoodNormalizationMap: [String: String] = [
        // Apple variants
        "green apple": "apple", "red apple": "apple", "fuji apple": "apple",
        "gala apple": "apple", "golden delicious": "apple", "granny smith": "apple",
        
        // Banana variants
        "banana": "banana", "plantain": "banana",
        
        // Orange/Citrus
        "navel orange": "orange", "blood orange": "orange", "mandarin": "orange",
        "tangerine": "orange", "grapefruit": "grapefruit", "pomelo": "pomelo",
        
        // Grape variants
        "red grapes": "grapes", "green grapes": "grapes", "purple grapes": "grapes",
        "black grapes": "grapes", "seedless grapes": "grapes",
        
        // Pear variants
        "asian pear": "pear", "ya pear": "pear", "snow pear": "pear",
        
        // Peach variants
        "white peach": "peach", "yellow peach": "peach", "nectarine": "peach",
        
        // Melons
        "seedless watermelon": "watermelon", "cantaloupe": "cantaloupe",
        "honeydew": "honeydew", "muskmelon": "melon",
        
        // Cabbage family
        "napa cabbage": "cabbage", "chinese cabbage": "cabbage", "bok choy": "bok choy",
        "baby bok choy": "bok choy", "lettuce": "lettuce", "romaine lettuce": "lettuce",
        
        // Tomato variants
        "tomato": "tomato", "cherry tomato": "cherry tomato", "roma tomato": "tomato",
        "beefsteak tomato": "tomato",
        
        // Potato variants
        "potato": "potato", "russet potato": "potato", "red potato": "potato",
        "yukon gold": "potato", "sweet potato": "sweet potato",
        
        // Cucumber variants
        "cucumber": "cucumber", "english cucumber": "cucumber", "persian cucumber": "cucumber",
        
        // Pepper variants
        "bell pepper": "bell pepper", "green pepper": "green pepper",
        "red pepper": "red pepper", "yellow pepper": "yellow pepper",
        "chili pepper": "chili", "jalapeno": "jalapeno",
        
        // Onion variants
        "red onion": "onion", "white onion": "onion", "yellow onion": "onion",
        "shallot": "shallot", "scallion": "scallion",
        
        // Dairy
        "whole milk": "milk", "skim milk": "milk", "low fat milk": "milk",
        "2% milk": "milk", "organic milk": "milk",
        "plain yogurt": "yogurt", "greek yogurt": "yogurt", "vanilla yogurt": "yogurt",
        
        // Eggs
        "free range eggs": "eggs", "organic eggs": "eggs", "duck eggs": "duck eggs",
        "quail eggs": "quail eggs",
        
        // Meat
        "pork chop": "pork", "pork belly": "pork", "bacon": "bacon",
        "beef steak": "beef", "ground beef": "beef", "beef brisket": "beef",
        "chicken breast": "chicken", "chicken thigh": "chicken", "chicken wing": "chicken",
        
        // Fish
        "salmon": "salmon", "tuna": "tuna", "cod": "cod", "tilapia": "tilapia",
        "sea bass": "sea bass", "trout": "trout", "halibut": "halibut",
        
        // Grains
        "jasmine rice": "rice", "basmati rice": "rice", "brown rice": "brown rice",
        "sticky rice": "sticky rice", "wild rice": "wild rice",
        "all purpose flour": "flour", "bread flour": "flour", "cake flour": "flour",
        "whole wheat flour": "whole wheat flour",
        
        // Vegetables
        "asparagus": "asparagus", "beet": "beet", "brussels sprout": "brussels sprout",
        "kale": "kale", "leek": "leek", "parsley": "parsley", "radish": "radish",
        "spinach": "spinach", "swiss chard": "swiss chard", "turnip": "turnip",
        "artichoke": "artichoke", "arugula": "arugula", "bean sprout": "bean sprout",
        "fennel": "fennel", "okra": "okra", "pea": "pea", "rhubarb": "rhubarb",
        
        // Fruits
        "blueberry": "blueberry", "cranberry": "cranberry", "fig": "fig",
        "kiwi": "kiwi", "lychee": "lychee", "papaya": "papaya",
        "persimmon": "persimmon", "pomegranate": "pomegranate", "raspberry": "raspberry",
        "star fruit": "star fruit",
        
        // Herbs
        "basil": "basil", "cilantro": "cilantro", "coriander": "cilantro",
        "dill": "dill", "mint": "mint", "oregano": "oregano",
        "rosemary": "rosemary", "sage": "sage", "thyme": "thyme"
    ]
    
    nonisolated private let ignorePrefixes: Set<String> = [
        "æ–°é²œ", "æœ‰æœº", "è¿›å£", "å›½äº§", "ç‰¹çº§", "ç²¾é€‰", "ä¼˜è´¨", "å¤©ç„¶",
        "å¤§", "å°", "ä¸­", "è€", "å«©", "ç”Ÿ", "ç†Ÿ", "å†·å†»", "é€Ÿå†»",
        "fresh", "organic", "imported", "domestic", "premium", "natural",
        "large", "small", "medium", "young", "tender", "raw", "cooked", "frozen"
    ]
    
    nonisolated private let ignoreSuffixes: Set<String> = [
        "ç‰‡", "ä¸", "å—", "æ¡", "ä¸", "æœ«", "æ®µ", "åœˆ", "ç²’", "æ³¥",
        "sliced", "diced", "chopped", "minced", "cubed", "strips", "pieces"
    ]
    
    nonisolated private let enhancedCategoryKeywords: [FoodCategory: Set<String>] = [
        .dairy: Set([
            // ä¹³åˆ¶å“
            "ç‰›å¥¶", "é…¸å¥¶", "å¥¶é…ª", "èŠå£«", "å¥¶æ²¹", "é»„æ²¹", "ç‚¼ä¹³", "å¥¶ç²‰", "ç¾Šå¥¶", "è±†å¥¶", "æ¤°å¥¶", "æä»å¥¶",
            "é©¬è‹é‡Œæ‹‰", "åˆ‡è¾¾", "å¸•ç›æ£®", "å¸ƒé‡Œ", "èŠå£«ç‰‡", "å¥¶æ˜”", "é…ªä¹³", "é…¸ç‰›å¥¶",
            // è‹±æ–‡
            "milk", "yogurt", "cheese", "cream", "butter", "mozzarella", "cheddar", "parmesan",
            "goat milk", "coconut milk", "almond milk", "soy milk", "buttermilk"
        ]),
        .eggs: Set([
            // è›‹ç±»
            "é¸¡è›‹", "é¸­è›‹", "é¹…è›‹", "é¹Œé¹‘è›‹", "å’¸é¸­è›‹", "æ¾èŠ±è›‹", "èŒ¶å¶è›‹", "è›‹ç™½", "è›‹é»„", "çš®è›‹", "å¤è›‹", "æ°´ç…®è›‹", "ç…è›‹", "ç‚’è›‹", "è’¸è›‹",
            // è‹±æ–‡
            "egg", "eggs", "duck eggs", "quail eggs", "goose eggs", "egg white", "egg yolk", "boiled egg", "fried egg", "scrambled egg"
        ]),
        .meat: Set([
            // çŒªè‚‰ç±»
            "çŒªè‚‰", "çŒªæ’", "çŒªè¹„", "äº”èŠ±è‚‰", "é‡Œè„Šè‚‰", "çŒªè…©", "çŒªé¢ˆè‚‰", "æ¢…èŠ±è‚‰", "å‰è…¿è‚‰", "åè…¿è‚‰",
            // ç‰›è‚‰ç±»
            "ç‰›è‚‰", "ç‰›æ’", "ç‰›è…©", "ç‰›ç­‹", "ç‰›å°¾", "ç‰›è…±", "ç‰›è„–", "ç‰›æŸ³", "è¥¿å†·", "è‚‹çœ¼",
            // ç¦½è‚‰ç±»
            "é¸¡è‚‰", "é¸­è‚‰", "é¹…è‚‰", "ç«é¸¡", "é¹Œé¹‘", "é¸½å­", "é¸¡è…¿", "é¸¡ç¿…", "é¸¡èƒ¸è‚‰", "é¸¡çˆª", "é¸­æŒ",
            // ç¾Šè‚‰ç±»
            "ç¾Šè‚‰", "ç¾Šæ’", "ç¾Šè…¿", "ç¾Šèå­", "ç¾Šè‚‰ä¸²",
            // è‚‰åˆ¶å“
            "é¦™è‚ ", "ç«è…¿", "åŸ¹æ ¹", "è…Šè‚‰", "å’¸è‚‰", "è‚‰æ¾", "è‚‰è„¯", "è‚‰ä¸¸", "è‚‰é¦…", "ç»è‚‰",
            // è‹±æ–‡
            "pork", "beef", "lamb", "chicken", "duck", "turkey",
            "sausage", "ham", "bacon", "ground meat", "steak", "ribs"
        ]),
        .seafood: Set([
            // æµ·é²œé±¼ç±»
            "é±¼", "é±¼è‚‰", "ä¸‰æ–‡é±¼", "é‡‘æªé±¼", "é³•é±¼", "é²ˆé±¼", "å¸¦é±¼", "é»„é±¼", "è‰é±¼", "é²¤é±¼", "é²«é±¼", "å¤§æ¯”ç›®é±¼",
            "é²‘é±¼", "é²­é±¼", "çŸ³æ–‘é±¼", "å¤šå®é±¼", "æµ·é²ˆé±¼", "æ¬§æ´²é²ˆé±¼", "é“¶é³•é±¼", "é»‘é³•é±¼", "ç½—éé±¼",
            // æµ·é²œè´å£³ç±»
            "è™¾", "èŸ¹", "èƒèŸ¹", "é¾™è™¾", "æ‰‡è´", "è›¤èœŠ", "ç”Ÿèš", "é±¿é±¼", "ç« é±¼", "æµ·å‚", "é²é±¼",
            "å¤§è™¾", "åŸºå›´è™¾", "ç™½è™¾", "æ²³è™¾", "æµ·è™¾", "è™¾ä»",
            "èƒèŸ¹", "å¤§é—¸èŸ¹", "æ¢­å­èŸ¹", "å¸ç‹èŸ¹", "èŸ¹è‚‰", "èŸ¹é»„",
            "æ‰‡è´", "ç”Ÿèš", "ç‰¡è›", "è›¤èœŠ", "èŠ±è›¤", "è›å­", "æµ·ç“œå­",
            // è‹±æ–‡
            "fish", "salmon", "tuna", "cod", "halibut", "sea bass", "trout", "mackerel", "sardine",
            "shrimp", "crab", "lobster", "scallop", "oyster", "squid", "octopus", "clam", "mussel",
            "seafood", "shellfish"
        ]),
        .vegetables: Set([
            // è”¬èœ - å¶èœç±»
            "ç™½èœ", "è èœ", "éŸ­èœ", "èŠ¹èœ", "ç”Ÿèœ", "æ²¹èœ", "å°ç™½èœ", "èŒ¼è’¿", "è‹‹èœ", "ç©ºå¿ƒèœ", "èœå¿ƒ", "èŠ¥èœ", "èŠ¥è“", "è èœ", "é¦™èœ", "é¦™è‘±", "éŸ­é»„", "ç¾½è¡£ç”˜è“", "ç‘å£«ç”œèœ", "èŠéº»èœ", "æ²¹éº¦èœ", "è±†è‹—", "èŒ¼è’¿", "ç´«è‹", "é±¼è…¥è‰", "é©¬é½¿è‹‹", "è’²å…¬è‹±", "è‰¾è‰",
            // è”¬èœ - æ ¹èŒç±»
            "èƒ¡èåœ", "èåœ", "ç™½èåœ", "çº¢èåœ", "åœŸè±†", "çº¢è–¯", "å±±è¯", "èŠ‹å¤´", "è²è—•", "ç«¹ç¬‹", "ç”Ÿå§œ", "å¤§è’œ", "æ´‹è‘±", "å¤§è‘±", "ç”œèœ", "éŸ­è‘±", "èŠœè", "å¤§é»„",
            // è”¬èœ - ç“œæœç±»
            "èŒ„å­", "è±†è§’", "é»„ç“œ", "è¥¿çº¢æŸ¿", "é’æ¤’", "è¾£æ¤’", "ç”œæ¤’", "å½©æ¤’", "èŠ±èœ", "è¥¿å…°èŠ±", "å·å¿ƒèœ", "ç´«ç”˜è“", "å†¬ç“œ", "ä¸ç“œ", "è‹¦ç“œ", "å—ç“œ", "èŠ¦ç¬‹", "æŠ±å­ç”˜è“", "æœé²œè“Ÿ", "ç§‹è‘µ", "è±Œè±†", "ä½›æ‰‹ç“œ", "èŠ‚ç“œ", "ç“ å­", "æ‰è±†", "èš•è±†", "æ¯›è±†", "è´ç¬‹",
            // è”¬èœ - èŒè‡ç±»
            "è˜‘è‡", "é¦™è‡", "å¹³è‡", "é‡‘é’ˆè‡", "æé²è‡", "èŒ¶æ ‘è‡", "å£è˜‘", "è‰è‡", "çŒ´å¤´è‡", "æœ¨è€³", "é“¶è€³",
            // è±†ç±»åˆ¶å“
            "è±†è…", "è±†å¹²", "è±†çš®", "è…ç«¹", "è±†èŠ½", "ç»¿è±†èŠ½", "é»„è±†èŠ½",
            // é¦™è‰å’Œè°ƒå‘³èœ
            "ç½—å‹’", "æ¬§èŠ¹", "è³è", "è–„è·", "ç‰›è‡³", "è¿·è¿­é¦™", "é¼ å°¾è‰", "ç™¾é‡Œé¦™", "ç´«è‹", "é±¼è…¥è‰", "é©¬é½¿è‹‹", "è’²å…¬è‹±", "è½¦å‰è‰", "è‰¾è‰", "èƒ¡æ¤’å¶",
            // è‹±æ–‡
            "cabbage", "spinach", "lettuce", "celery", "kale", "swiss chard", "arugula",
            "carrot", "radish", "potato", "sweet potato", "onion", "garlic", "ginger", "tomato", "cucumber", "eggplant", "beet", "leek", "turnip", "rhubarb",
            "pepper", "cauliflower", "broccoli", "mushroom", "tofu", "asparagus", "brussels sprout", "artichoke", "fennel", "okra", "pea",
            "basil", "parsley", "dill", "mint", "oregano", "rosemary", "sage", "thyme"
        ]),
        .fruits: Set([
            // æ°´æœ - æ¸©å¸¦æ°´æœ
            "è‹¹æœ", "æ¢¨", "æ¡ƒå­", "æå­", "æ", "æ¨±æ¡ƒ", "è‘¡è„", "çŸ³æ¦´", "æ— èŠ±æœ", "çŒ•çŒ´æ¡ƒ", "å±±æ¥‚", "æ‡æ·", "æ¨æ¢…", "æ¡‘è‘š", "é…¸æ£", "æ²™æ£˜",
            // æ°´æœ - æŸ‘æ©˜ç±»
            "æ©™å­", "æŸ æª¬", "æŸšå­", "æ©˜å­", "æ¡”å­", "é‡‘æ¡”", "æŸ‘", "é’æŸ ", "ä½›æ‰‹", "é¦™æ©¼",
            // æ°´æœ - æµ†æœç±»
            "è‰è“", "è“è“", "é»‘è“", "è¦†ç›†å­", "è”“è¶Šè“", "æ¡‘è‘š", "è‘¡è„å¹²", "æå­",
            // æ°´æœ - çƒ­å¸¦æ°´æœ
            "è¥¿ç“œ", "å“ˆå¯†ç“œ", "é¦™ç“œ", "ç”œç“œ", "æœ¨ç“œ", "èŠ’æœ", "è è", "é¦™è•‰", "é¾™çœ¼", "è”æ", "æ¤°å­", "ç«é¾™æœ", "ç™¾é¦™æœ", "æ¦´è²", "æ¨æ¡ƒ", "çº¢æ¯›ä¸¹", "å±±ç«¹", "è²é›¾", "ç•ªçŸ³æ¦´", "é‡Šè¿¦", "äººå‚æœ",
            // è‹±æ–‡
            "apple", "pear", "grape", "peach", "plum", "cherry", "orange", "lemon", "grapefruit", "strawberry", "blueberry", "blackberry", "raspberry", "cranberry",
            "watermelon", "cantaloupe", "mango", "pineapple", "banana", "kiwi"
        ]),
        .grains: Set([
            // è°·ç‰©ä¸»é£Ÿ
            "å¤§ç±³", "å°ç±³", "é»‘ç±³", "ç³¯ç±³", "é¦™ç±³", "æ³°é¦™ç±³", "å°éº¦", "å¤§éº¦", "ç‡•éº¦", "è—œéº¦", "èéº¦", "é«˜ç²±", "ç‰ç±³",
            // é¢ç²‰åˆ¶å“
            "é¢ç²‰", "å…¨éº¦ç²‰", "ç‰ç±³ç²‰", "é¢åŒ…", "åå¸", "é¦’å¤´", "èŠ±å·", "åŒ…å­", "çƒ§é¥¼",
            // é¢æ¡ç±»
            "é¢æ¡", "æŒ‚é¢", "æ„å¤§åˆ©é¢", "é€šå¿ƒç²‰", "æ‹‰é¢", "ä¹Œå†¬é¢", "èéº¦é¢", "ç±³ç²‰", "ç²‰ä¸", "ç²‰æ¡", "å‡‰çš®", "æ²³ç²‰",
            // ä¸»é£Ÿåˆ¶å“
            "é¥ºå­", "é¦„é¥¨", "æ±¤åœ†", "å¹´ç³•", "ç²½å­", "æœˆé¥¼",
            // è‹±æ–‡
            "rice", "millet", "black rice", "wheat", "barley", "oats", "quinoa", "buckwheat", "corn",
            "flour", "bread", "noodles", "pasta", "macaroni", "ramen", "udon", "soba"
        ]),
        .beverages: Set([
            // æ°´ç±»
            "æ°´", "çŸ¿æ³‰æ°´", "çº¯å‡€æ°´", "è‹æ‰“æ°´", "æ°”æ³¡æ°´", "æŸ æª¬æ°´", "èœ‚èœœæ°´",
            // æœæ±ç±»
            "æœæ±", "æ©™æ±", "è‹¹æœæ±", "è‘¡è„æ±", "è¥¿ç“œæ±", "æŸ æª¬æ±", "è”¬èœæ±", "èƒ¡èåœæ±",
            // ç¢³é…¸é¥®æ–™
            "å¯ä¹", "é›ªç¢§", "èŠ¬è¾¾", "æ±½æ°´", "æŸ æª¬æ±½æ°´", "è‹æ‰“æ°´",
            // èŒ¶ç±»
            "èŒ¶", "ç»¿èŒ¶", "çº¢èŒ¶", "ä¹Œé¾™èŒ¶", "æ™®æ´±èŒ¶", "èŠ±èŒ¶", "æŸ æª¬èŒ¶", "å¥¶èŒ¶", "èœ‚èœœèŒ¶",
            // å’–å•¡ç±»
            "å’–å•¡", "æ‹¿é“", "å¡å¸ƒå¥‡è¯º", "ç¾å¼å’–å•¡", "æ‘©å¡", "é€Ÿæº¶å’–å•¡",
            // é…’ç±»
            "å•¤é…’", "ç™½é…’", "çº¢é…’", "é¦™æ§Ÿ", "å¨å£«å¿Œ", "ä¼ç‰¹åŠ ", "é»„é…’", "ç±³é…’", "æ–™é…’",
            // å…¶ä»–é¥®å“
            "è±†æµ†", "æ¤°æ±", "æä»éœ²", "æ ¸æ¡ƒéœ²", "è¿åŠ¨é¥®æ–™", "åŠŸèƒ½é¥®æ–™",
            // è‹±æ–‡
            "water", "mineral water", "juice", "orange juice", "apple juice", "soda", "cola", "tea", "green tea",
            "coffee", "latte", "beer", "wine", "whiskey", "vodka", "milk tea", "sports drink"
        ]),
        .condiments: Set([
            // åŸºç¡€è°ƒæ–™
            "ç›", "ç³–", "å†°ç³–", "çº¢ç³–", "èœ‚èœœ", "æ«ç³–", "é†‹", "ç™½é†‹", "é¦™é†‹", "ç±³é†‹",
            // é…±æ²¹ç±»
            "é…±æ²¹", "ç”ŸæŠ½", "è€æŠ½", "è’¸é±¼è±‰æ²¹", "å‘³æé²œ", "é²œå‘³æ±",
            // é¦™æ–™ç±»
            "èƒ¡æ¤’ç²‰", "é»‘èƒ¡æ¤’", "ç™½èƒ¡æ¤’", "è¾£æ¤’ç²‰", "èŠ±æ¤’", "å­œç„¶", "å…«è§’", "æ¡‚çš®", "ä¸é¦™", "è‚‰æ¡‚", "é¦™å¶", "è‰æœ",
            // é…±æ–™ç±»
            "è±†ç“£é…±", "ç”œé¢é…±", "æµ·é²œé…±", "èšæ²¹", "é±¼éœ²", "è¾£æ¤’é…±", "ç•ªèŒ„é…±", "æ²™æ‹‰é…±", "è›‹é»„é…±", "èŠ¥æœ«é…±", "åƒå²›é…±",
            // æ²¹ç±»
            "é¦™æ²¹", "èŠéº»æ²¹", "æ©„æ¦„æ²¹", "èŠ±ç”Ÿæ²¹", "èœç±½æ²¹", "ç‰ç±³æ²¹", "æ¤°å­æ²¹", "äºšéº»ç±½æ²¹",
            // é…’æ–™ç±»
            "æ–™é…’", "é»„é…’", "ç±³é…’", "ç™½å…°åœ°", "æœ—å§†é…’",
            // å…¶ä»–è°ƒå‘³å“
            "å‘³ç²¾", "é¸¡ç²¾", "åä¸‰é¦™", "äº”é¦™ç²‰", "å’–å–±ç²‰", "èŠéº»", "èŠ±ç”Ÿé…±", "æœé…±",
            // è‹±æ–‡
            "salt", "sugar", "honey", "vinegar", "soy sauce", "oil", "olive oil", "pepper", "spice",
            "ketchup", "mustard", "mayonnaise", "sesame oil", "chili sauce", "garlic sauce"
        ]),
        .frozen: Set([
            // å†·å†»ç”œå“
            "å†°æ·‡æ·‹", "é›ªç³•", "å†°æ£", "å†°æ£’", "é›ªç³•", "åœ£ä»£", "å†°æ²™",
            // é€Ÿå†»é£Ÿå“
            "é€Ÿå†»é¥ºå­", "é€Ÿå†»åŒ…å­", "é€Ÿå†»æ±¤åœ†", "é€Ÿå†»é¦„é¥¨", "æ˜¥å·", "é”…è´´", "çƒ§é¥¼",
            // å†·å†»ä¸»é£Ÿ
            "å†·å†»è–¯æ¡", "å†·å†»æŠ«è¨", "å†·å†»é¢åŒ…", "å†·å†»è›‹ç³•",
            // å†·å†»è‚‰ç±»æµ·é²œ
            "å†·å†»è™¾ä»", "å†·å†»é±¼ç‰‡", "å†·å†»è‚‰ä¸¸", "å†·å†»é¸¡å—", "å†·å†»ç‰›è‚‰ç‰‡",
            // å†·å†»è”¬èœæ°´æœ
            "é€Ÿå†»è”¬èœ", "å†·å†»ç‰ç±³", "å†·å†»è±Œè±†", "å†·å†»èƒ¡èåœ", "å†·å†»æ°´æœ", "å†·å†»æµ†æœ",
            // è‹±æ–‡
            "ice cream", "popsicle", "frozen dumpling", "frozen pizza", "frozen fries", "frozen vegetables",
            "frozen fruit", "frozen berries", "frozen meat", "frozen seafood"
        ]),
        .canned: Set([
            // ç½å¤´æ ‡è¯†
            "ç½å¤´", "ç½è£…", "å¬è£…", "ç“¶è£…", "å¯†å°åŒ…è£…", "çœŸç©ºåŒ…è£…",
            // è‚‰ç±»ç½å¤´
            "åˆé¤è‚‰", "çº¢çƒ§è‚‰ç½å¤´", "ç‰›è‚‰ç½å¤´", "é¸¡è‚‰ç½å¤´", "é‡‘æªé±¼ç½å¤´", "æ²™ä¸é±¼ç½å¤´", "è±†è±‰é²®é±¼",
            // æ°´æœç½å¤´
            "é»„æ¡ƒç½å¤´", "æ©˜å­ç½å¤´", "æ¢¨ç½å¤´", "è èç½å¤´", "æ¨±æ¡ƒç½å¤´", "å±±æ¥‚ç½å¤´",
            // è”¬èœç½å¤´
            "ç•ªèŒ„ç½å¤´", "ç‰ç±³ç½å¤´", "è±Œè±†ç½å¤´", "è˜‘è‡ç½å¤´", "ç¬‹ç½å¤´", "æ³¡èœç½å¤´",
            // å…¶ä»–ç½å¤´
            "æ¤°å¥¶ç½å¤´", "ç‚¼ä¹³ç½å¤´", "è±†ç±»ç½å¤´", "æ±¤ç½å¤´",
            // è‹±æ–‡
            "canned", "can", "jar", "preserved", "canned tuna", "canned corn", "canned tomato",
            "canned peach", "canned pineapple", "spam", "canned soup"
        ]),
        .snacks: Set([
            // è–¯ç±»é›¶é£Ÿ
            "è–¯ç‰‡", "è–¯æ¡", "è™¾æ¡", "é”…å·´", "çˆ†ç±³èŠ±", "ç‰ç±³ç‰‡",
            // é¥¼å¹²ç³•ç‚¹
            "é¥¼å¹²", "æ›²å¥‡", "å¨åŒ–", "è‹æ‰“é¥¼å¹²", "æ¶ˆåŒ–é¥¼å¹²", "å¥¥åˆ©å¥¥", "è›‹ç³•", "é©¬å¡é¾™", "æ³¡èŠ™",
            // ç³–æœå·§å…‹åŠ›
            "å·§å…‹åŠ›", "ç™½å·§å…‹åŠ›", "é»‘å·§å…‹åŠ›", "ç‰›å¥¶å·§å…‹åŠ›", "ç³–æœ", "è½¯ç³–", "ç¡¬ç³–", "æ£’æ£’ç³–", "å£é¦™ç³–", "è–„è·ç³–",
            // åšæœç±»
            "ç“œå­", "è‘µèŠ±ç±½", "å—ç“œå­", "è¥¿ç“œå­", "èŠ±ç”Ÿ", "å¼€å¿ƒæœ", "è…°æœ", "æ ¸æ¡ƒ", "æä»", "å¤å¨å¤·æœ", "ç¢§æ ¹æœ", "æ¾å­", "æ¦›å­",
            // æœå¹²èœœé¥¯
            "è‘¡è„å¹²", "å¤§æ£", "çº¢æ£", "èœœæ£", "æ¡‚åœ†", "æ¸æ", "èœœé¥¯", "æœè„¯", "è¯æ¢…", "å±±æ¥‚ç‰‡", "æ— èŠ±æœå¹²", "æå¹²",
            // è‚‰ç±»é›¶é£Ÿ
            "è‚‰å¹²", "ç‰›è‚‰å¹²", "çŒªè‚‰è„¯", "é±¿é±¼ä¸", "é±¼ç‰‡", "è™¾ç‰‡", "èŸ¹æ£’",
            // å…¶ä»–é›¶é£Ÿ
            "æœå†»", "å¸ƒä¸", "ä»™è´", "ç±³é¥¼", "æµ·è‹”", "ç´«èœ", "å±±æ ¸æ¡ƒ",
            // è‹±æ–‡
            "chips", "fries", "popcorn", "cookies", "crackers", "biscuit", "chocolate", "candy",
            "nuts", "peanuts", "almonds", "cashews", "dried fruit", "jerky", "gummy", "jelly"
        ])
    ]
    
    nonisolated private let enhancedEmojiMappings: [String: String] = [
        // æ°´æœ
        "è‹¹æœ": "ğŸ", "apple": "ğŸ",
        "é¦™è•‰": "ğŸŒ", "banana": "ğŸŒ",
        "æ©™å­": "ğŸŠ", "orange": "ğŸŠ",
        "æŸ æª¬": "ğŸ‹", "lemon": "ğŸ‹",
        "è¥¿ç“œ": "ğŸ‰", "watermelon": "ğŸ‰",
        "è‘¡è„": "ğŸ‡", "grapes": "ğŸ‡",
        "è‰è“": "ğŸ“", "strawberry": "ğŸ“",
        "æ¨±æ¡ƒ": "ğŸ’", "cherry": "ğŸ’",
        "æ¡ƒå­": "ğŸ‘", "peach": "ğŸ‘",
        "è è": "ğŸ", "pineapple": "ğŸ",
        "èŠ’æœ": "ğŸ¥­", "mango": "ğŸ¥­",
        "çŒ•çŒ´æ¡ƒ": "ğŸ¥", "kiwi": "ğŸ¥",
        "æ¤°å­": "ğŸ¥¥", "coconut": "ğŸ¥¥",
        "ç‰›æ²¹æœ": "ğŸ¥‘", "avocado": "ğŸ¥‘",
        "æ¢¨": "ğŸ", "pear": "ğŸ",
        "è“è“": "ğŸ«", "blueberry": "ğŸ«",
        "è¦†ç›†å­": "ğŸ«", "raspberry": "ğŸ«",
        "é»‘è“": "ğŸ«", "blackberry": "ğŸ«",
        "è”“è¶Šè“": "ğŸ«", "cranberry": "ğŸ«",
        "çŸ³æ¦´": "ğŸ«’", "pomegranate": "ğŸ«’",
        "æ— èŠ±æœ": "ğŸ«’", "fig": "ğŸ«’",
        "è”æ": "ğŸ’", "lychee": "ğŸ’",
        "æœ¨ç“œ": "ğŸ¥­", "papaya": "ğŸ¥­",
        "æŸ¿å­": "ğŸ‘", "persimmon": "ğŸ‘",
        "æ¨æ¡ƒ": "ğŸŒŸ", "star fruit": "ğŸŒŸ",
        
        // è”¬èœ
        "è¥¿çº¢æŸ¿": "ğŸ…", "tomato": "ğŸ…",
        "èŒ„å­": "ğŸ†", "eggplant": "ğŸ†",
        "ç‰ç±³": "ğŸŒ½", "corn": "ğŸŒ½",
        "èƒ¡èåœ": "ğŸ¥•", "carrot": "ğŸ¥•",
        "è¾£æ¤’": "ğŸŒ¶ï¸", "chili": "ğŸŒ¶ï¸",
        "é’æ¤’": "ğŸ«‘", "bell pepper": "ğŸ«‘",
        "é»„ç“œ": "ğŸ¥’", "cucumber": "ğŸ¥’",
        "è¥¿å…°èŠ±": "ğŸ¥¦", "broccoli": "ğŸ¥¦",
        "ç™½èœ": "ğŸ¥¬", "cabbage": "ğŸ¥¬",
        "ç”Ÿèœ": "ğŸ¥¬", "lettuce": "ğŸ¥¬",
        "æ´‹è‘±": "ğŸ§…", "onion": "ğŸ§…",
        "å¤§è’œ": "ğŸ§„", "garlic": "ğŸ§„",
        "åœŸè±†": "ğŸ¥”", "potato": "ğŸ¥”",
        "çº¢è–¯": "ğŸ ", "sweet potato": "ğŸ ",
        "è˜‘è‡": "ğŸ„", "mushroom": "ğŸ„",
        "èŠ¦ç¬‹": " asparagus", "asparagus": " asparagus",
        "ç”œèœ": "ğŸ ", "beet": "ğŸ ",
        "æŠ±å­ç”˜è“": "ğŸ¥¬", "brussels sprout": "ğŸ¥¬",
        "ç¾½è¡£ç”˜è“": "ğŸ¥¬", "kale": "ğŸ¥¬",
        "éŸ­è‘±": "ğŸ¥¬", "leek": "ğŸ¥¬",
        "æ¬§èŠ¹": "ğŸŒ¿", "parsley": "ğŸŒ¿",
        "èåœ": "ğŸ¥•", "radish": "ğŸ¥•",
        "è èœ": "ğŸ¥¬", "spinach": "ğŸ¥¬",
        "ç‘å£«ç”œèœ": "ğŸ¥¬", "swiss chard": "ğŸ¥¬",
        "èŠœè": " turnips", "turnip": " turnips",
        "æœé²œè“Ÿ": "ğŸ«’", "artichoke": "ğŸ«’",
        "èŠéº»èœ": "ğŸ¥¬", "arugula": "ğŸ¥¬",
        "è±†èŠ½": "ğŸŒ±", "bean sprout": "ğŸŒ±",
        "èŒ´é¦™": "ğŸŒ¿", "fennel": "ğŸŒ¿",
        "ç§‹è‘µ": "ğŸ¥¬", "okra": "ğŸ¥¬",
        "è±Œè±†": "ğŸ«›", "pea": "ğŸ«›",
        "å¤§é»„": "ğŸ¥¬", "rhubarb": "ğŸ¥¬",

        // é¦™è‰
        "ç½—å‹’": "ğŸŒ¿", "basil": "ğŸŒ¿",
        "é¦™èœ": "ğŸŒ¿", "cilantro": "ğŸŒ¿",
        "è³è": "ğŸŒ¿", "dill": "ğŸŒ¿",
        "è–„è·": "ğŸŒ¿", "mint": "ğŸŒ¿",
        "ç‰›è‡³": "ğŸŒ¿", "oregano": "ğŸŒ¿",
        "è¿·è¿­é¦™": "ğŸŒ¿", "rosemary": "ğŸŒ¿",
        "é¼ å°¾è‰": "ğŸŒ¿", "sage": "ğŸŒ¿",
        "ç™¾é‡Œé¦™": "ğŸŒ¿", "thyme": "ğŸŒ¿",
        
        // è‚‰ç±»
        "ç‰›è‚‰": "ğŸ¥©", "beef": "ğŸ¥©",
        "çŒªè‚‰": "ğŸ¥“", "pork": "ğŸ¥“",
        "é¸¡è‚‰": "ğŸ—", "chicken": "ğŸ—",
        "é±¼": "ğŸŸ", "fish": "ğŸŸ",
        "ä¸‰æ–‡é±¼": "ğŸŸ", "salmon": "ğŸŸ",
        "é³•é±¼": "ğŸŸ", "cod": "ğŸŸ",
        "å¤§æ¯”ç›®é±¼": "ğŸŸ", "halibut": "ğŸŸ",
        "è™¾": "ğŸ¦", "shrimp": "ğŸ¦",
        "èŸ¹": "ğŸ¦€", "crab": "ğŸ¦€",
        "é¾™è™¾": "ğŸ¦", "lobster": "ğŸ¦",
        "é±¿é±¼": "ğŸ¦‘", "squid": "ğŸ¦‘",
        "ç«è…¿": "ğŸ–", "ham": "ğŸ–",
        
        // è›‹å¥¶
        "é¸¡è›‹": "ğŸ¥š", "egg": "ğŸ¥š",
        "ç‰›å¥¶": "ğŸ¥›", "milk": "ğŸ¥›",
        "å¥¶é…ª": "ğŸ§€", "cheese": "ğŸ§€",
        "é»„æ²¹": "ğŸ§ˆ", "butter": "ğŸ§ˆ",
        "é…¸å¥¶": "ğŸ¥›", "yogurt": "ğŸ¥›",
        
        // ä¸»é£Ÿ
        "é¢åŒ…": "ğŸ", "bread": "ğŸ",
        "å¤§ç±³": "ğŸš", "rice": "ğŸš",
        "é¢æ¡": "ğŸœ", "noodles": "ğŸœ",
        "æ„é¢": "ğŸ", "pasta": "ğŸ",
        "é¥ºå­": "ğŸ¥Ÿ", "dumpling": "ğŸ¥Ÿ",
        "åŒ…å­": "ğŸ¥Ÿ", "baozi": "ğŸ¥Ÿ",
        
        // é¥®æ–™
        "å’–å•¡": "â˜•", "coffee": "â˜•",
        "èŒ¶": "ğŸµ", "tea": "ğŸµ",
        "å•¤é…’": "ğŸº", "beer": "ğŸº",
        "çº¢é…’": "ğŸ·", "wine": "ğŸ·",
        "æœæ±": "ğŸ§ƒ", "juice": "ğŸ§ƒ",
        "å¯ä¹": "ğŸ¥¤", "cola": "ğŸ¥¤",
        "æ°´": "ğŸ’§", "water": "ğŸ’§",
        
        // é›¶é£Ÿ
        "è–¯ç‰‡": "ğŸŸ", "chips": "ğŸŸ",
        "é¥¼å¹²": "ğŸª", "cookie": "ğŸª",
        "å·§å…‹åŠ›": "ğŸ«", "chocolate": "ğŸ«",
        "ç³–æœ": "ğŸ¬", "candy": "ğŸ¬",
        "å†°æ·‡æ·‹": "ğŸ¦", "ice cream": "ğŸ¦",
        "è›‹ç³•": "ğŸ°", "cake": "ğŸ°",
        "çˆ†ç±³èŠ±": "ğŸ¿", "popcorn": "ğŸ¿",
        "åšæœ": "ğŸ¥œ", "nuts": "ğŸ¥œ",
        "èŠ±ç”Ÿ": "ğŸ¥œ", "peanut": "ğŸ¥œ",
        
        // è°ƒæ–™
        "ç›": "ğŸ§‚", "salt": "ğŸ§‚",
        "èœ‚èœœ": "ğŸ¯", "honey": "ğŸ¯",
        "æ²¹": "ğŸ«’", "oil": "ğŸ«’",
        "é…±æ²¹": "ğŸ¥«", "soy sauce": "ğŸ¥«",
        "é†‹": "ğŸ¾", "vinegar": "ğŸ¾",
        
        // æ–°å¢é£Ÿæemoji
        "æ²¹éº¦èœ": "ğŸ¥¬", "leaf lettuce": "ğŸ¥¬",
        "éŸ­èœ": "ğŸ¥¬", "chive": "ğŸ¥¬",
        "ç©ºå¿ƒèœ": "ğŸ¥¬", "water spinach": "ğŸ¥¬",
        "èŠ¥è“": "ğŸ¥¦", "chinese broccoli": "ğŸ¥¦",
        "èŒ¼è’¿": "ğŸ¥¬", "chrysanthemum greens": "ğŸ¥¬",
        "è‹‹èœ": "ğŸ¥¬", "amaranth greens": "ğŸ¥¬",
        "è èœ": "ğŸ¥¬", "shepherd's purse": "ğŸ¥¬",
        "è±†è‹—": "ğŸŒ±", "pea shoots": "ğŸŒ±",
        "è±†è§’": "ğŸ¥«", "green beans": "ğŸ¥«",
        "æ‰è±†": "ğŸ¥«", "lima beans": "ğŸ¥«",
        "èš•è±†": "ğŸ¥«", "fava beans": "ğŸ¥«",
        "æ¯›è±†": "ğŸ¥«", "edamame": "ğŸ¥«",
        "è´ç¬‹": "ğŸ¥¬", "lettuce stem": "ğŸ¥¬",
        "ç´«ç”˜è“": "ğŸ¥¬", "purple cabbage": "ğŸ¥¬",
        "å†¬ç“œ": "ğŸ¥’", "winter melon": "ğŸ¥’",
        "ä¸ç“œ": "ğŸ¥’", "luffa": "ğŸ¥’",
        "è‹¦ç“œ": "ğŸ¥’", "bitter melon": "ğŸ¥’",
        "å—ç“œ": "ğŸƒ", "pumpkin": "ğŸƒ",
        "ä½›æ‰‹ç“œ": "ğŸ", "chayote": "ğŸ",
        "èŠ‚ç“œ": "ğŸ¥¦", "fuzzy melon": "ğŸ¥¦",
        "ç“ å­": "ğŸ¥’", "bottle gourd": "ğŸ¥’",
        "é¾™çœ¼": "ğŸ’", "longan": "ğŸ’",
        "çº¢æ¯›ä¸¹": "ğŸ’", "rambutan": "ğŸ’",
        "å±±ç«¹": "ğŸ’", "mangosteen": "ğŸ’",
        "æ¦´è²": "ğŸ’", "durian": "ğŸ’",
        "è²é›¾": "ğŸ", "rose apple": "ğŸ",
        "ç•ªçŸ³æ¦´": "ğŸ", "guava": "ğŸ",
        "é‡Šè¿¦": "ğŸ", "sugar apple": "ğŸ",
        "äººå‚æœ": "ğŸ", "pepino": "ğŸ",
        "æ‡æ·": "ğŸ‘", "loquat": "ğŸ‘",
        "æ¨æ¢…": "ğŸ’", "bayberry": "ğŸ’",
        "æ¡‘è‘š": "ğŸ‡", "mulberry": "ğŸ‡",
        "é…¸æ£": "ğŸ’", "wild jujube": "ğŸ’",
        "æ²™æ£˜": "ğŸŠ", "sea buckthorn": "ğŸŠ",
        "ç´«è‹": "ğŸŒ¿", "perilla": "ğŸŒ¿",
        "é±¼è…¥è‰": "ğŸŒ¿", "houttuynia": "ğŸŒ¿",
        "é©¬é½¿è‹‹": "ğŸŒ¿", "purslane": "ğŸŒ¿",
        "è’²å…¬è‹±": "ğŸŒ¿", "dandelion": "ğŸŒ¿",
        "è½¦å‰è‰": "ğŸŒ¿", "plantain": "ğŸŒ¿",
        "è‰¾è‰": "ğŸŒ¿", "mugwort": "ğŸŒ¿",
        "èƒ¡æ¤’å¶": "ğŸŒ¿", "curry leaves": "ğŸŒ¿"
    ]
    
    nonisolated private func normalizeFoodName(_ name: String) -> String {
        var normalized = name.lowercased().trimmingCharacters(in: .whitespacesAndNewlines)
        
        // ç§»é™¤å‰ç¼€
        for prefix in ignorePrefixes {
            if normalized.hasPrefix(prefix) {
                normalized = String(normalized.dropFirst(prefix.count)).trimmingCharacters(in: .whitespacesAndNewlines)
            }
        }
        
        // ç§»é™¤åç¼€
        for suffix in ignoreSuffixes {
            if normalized.hasSuffix(suffix) {
                normalized = String(normalized.dropLast(suffix.count)).trimmingCharacters(in: .whitespacesAndNewlines)
            }
        }
        
        // åˆ¤æ–­è¯­è¨€å¹¶ä½¿ç”¨å¯¹åº”çš„æ˜ å°„
        let isChineseInput = containsChinese(normalized)
        let mappingToUse = isChineseInput ? chineseFoodNormalizationMap : englishFoodNormalizationMap
        
        // æŸ¥æ‰¾è§„èŒƒåŒ–æ˜ å°„
        if let standardName = mappingToUse[normalized] {
            return standardName
        }
        
        // éƒ¨åˆ†åŒ¹é…è§„èŒƒåŒ–
        for (variant, standard) in mappingToUse {
            if normalized.contains(variant) || variant.contains(normalized) {
                return standard
            }
        }
        
        return normalized
    }
    
    nonisolated private func containsChinese(_ text: String) -> Bool {
        for char in text {
            if ("\u{4e00}"..."\u{9fff}").contains(char) {
                return true
            }
        }
        return false
    }
    
    func classify(name: String) async -> (FoodCategory, String?) {
        let normalizedName = normalizeFoodName(name)
        
        // è·å–åˆ†ç±»
        let category = classifyByKeywords(normalizedName)
        
        // è·å–emoji
        let emoji = getEmoji(for: normalizedName)
        
        print("[LocalFoodClassifier] '\(name)' â†’ normalized: '\(normalizedName)' â†’ category: \(category), emoji: \(emoji ?? "nil")")
        
        return (category, emoji)
    }
    
    func classifyBatch(names: [String]) async -> [(FoodCategory, String?)] {
        await withTaskGroup(of: (Int, FoodCategory, String?).self) { group in
            var results: [(FoodCategory, String?)] = Array(repeating: (.other, nil), count: names.count)
            
            // Process each name concurrently
            for (index, name) in names.enumerated() {
                group.addTask { [self] in
                    let normalizedName = self.normalizeFoodName(name)
                    let category = self.classifyByKeywords(normalizedName)
                    let emoji = self.getEmoji(for: normalizedName)
                    return (index, category, emoji)
                }
            }
            
            // Collect results in correct order
            for await (index, category, emoji) in group {
                results[index] = (category, emoji)
            }
            
            return results
        }
    }
    
    nonisolated private func classifyByKeywords(_ normalizedName: String) -> FoodCategory {
        var bestMatch: (category: FoodCategory, score: Int) = (.other, 0)
        
        for (category, keywords) in enhancedCategoryKeywords {
            for keyword in keywords {
                let keywordLower = keyword.lowercased()
                if normalizedName == keywordLower {
                    // å®Œå…¨åŒ¹é…ï¼Œç›´æ¥è¿”å›
                    return category
                } else if normalizedName.contains(keywordLower) {
                    // éƒ¨åˆ†åŒ¹é…ï¼Œè®¡ç®—å¾—åˆ†ï¼ˆè¶Šé•¿çš„å…³é”®è¯å¾—åˆ†è¶Šé«˜ï¼‰
                    let score = keywordLower.count
                    if score > bestMatch.score {
                        bestMatch = (category, score)
                    }
                }
            }
        }
        
        return bestMatch.score > 0 ? bestMatch.category : .other
    }
    
    nonisolated private func getEmoji(for normalizedName: String) -> String? {
        // ç›´æ¥åŒ¹é…
        if let emoji = enhancedEmojiMappings[normalizedName] {
            return emoji
        }
        
        // éƒ¨åˆ†åŒ¹é…ï¼ˆä¼˜å…ˆæ›´é•¿çš„åŒ¹é…ï¼‰
        var bestMatch: (emoji: String, length: Int) = ("", 0)
        for (food, emoji) in enhancedEmojiMappings {
            let foodLower = food.lowercased()
            if normalizedName.contains(foodLower) || foodLower.contains(normalizedName) {
                if foodLower.count > bestMatch.length {
                    bestMatch = (emoji, foodLower.count)
                }
            }
        }
        
        return bestMatch.length > 0 ? bestMatch.emoji : nil
    }
}